#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 提交信息格式验证
# 格式: <type>(<scope>): <subject>
# 例如: feat(auth): 添加用户登录功能

commit_msg=$(cat "$1")

# 允许的类型
types="feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert"

# 验证提交信息格式
if ! echo "$commit_msg" | grep -qE "^($types)(\(.+\))?: .{1,}$"; then
    echo "❌ 提交信息格式错误！"
    echo ""
    echo "正确格式: <type>(<scope>): <subject>"
    echo ""
    echo "允许的类型:"
    echo "  feat:     新功能"
    echo "  fix:      修复 bug"
    echo "  docs:     文档更新"
    echo "  style:    代码格式调整"
    echo "  refactor: 重构"
    echo "  test:     测试相关"
    echo "  chore:    构建/工具相关"
    echo "  perf:     性能优化"
    echo "  ci:       CI/CD 相关"
    echo "  build:    构建系统"
    echo "  revert:   回滚"
    echo ""
    echo "示例:"
    echo "  feat(auth): 添加用户登录功能"
    echo "  fix(api): 修复数据查询错误"
    echo "  docs: 更新 README"
    echo ""
    exit 1
fi
